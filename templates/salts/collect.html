{% extends "base.html" %}
{% load static %}
{% block msg %}{% include "message.html" %}{% endblock %}
{% block head %}
<script src="https://cdn.bootcss.com/jquery.form/4.2.2/jquery.form.min.js"></script>
<style>
  #result textarea {
    width: 400px;
    height: 200px;
    margin-top: 10px;
    display: none;
  }
  #loading {
    background: url({% static 'css/images/loading.gif' %}) no-repeat 10px;
    line-height: 20px;
    font-size: 16px;
    color: #666;
    text-indent: 40px;
  }
</style>
<script>
    $(function () {
        $("button").button();

        $("form").ajaxForm({
            type: "POST",
            url: "{% url 'collect' %}",
            dataType: "json",
            beforeSubmit: function (arr, form, options) {
                $("button").button("disable");
                $("#loading").dialog("open");
            },
            success: function (response, statusText, xhr, form) {
                $("#loading").css("background", "url({% static 'css/images/checked.gif' %}) no-repeat 10px").html("提交成功...");
                $("button").button("enable");
                $.each(response, function(index, value) {
                    $("#test-result").text($("#test-result").text() + index + ": " + value + "\n");
                });
                $("#test-result").show();
                setTimeout(function () {
                    $("#loading").dialog("close");
                    $("form").resetForm();
                    $("#loading").css("background", "url({% static 'css/images/loading.gif' %}) no-repeat 10px").html("命令执行中...");
                }, 1000)
            }
        });

        $("button").click(function () {
            $("#test-result").html("");
            $("form").submit()
        });

        $("#loading").dialog({
            autoOpen: false,
            draggable: false,
            modal: true,
            resizable: false,
            width: 180,
            height: 50
        }).parent().find(".ui-widget-header").hide();

        $("#menu").menu()
    })
</script>
{% endblock %}
{% block content %}
{% include "sidebar.html" %}
<div class="content-page">
    <!-- Start content -->
    <div class="content">
        <div class="container">
            <h3>saltstack 客户端</h3>
            <form class="form-horizontal" role="form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="_ip" class="col-md-2 control-label">IP地址</label>
                    <div class="col-md-10">
                        <input id="_ip" type="text" required name="ip" class="form-control">
                    </div>
                </div>
                <button type="button" class="btn btn-info">执行收集</button>
            </form>
        </div>
        <div id="result" class="container">
           <textarea id="test-result" wrap="hard"></textarea>
           <div><a class="btn btn-success" href="{% url 'add' %}" target="_blank" style="margin-top: 5px;">添加到资产列表</a></div>
        </div>
    </div>
    <div id="loading">命令执行中...</div>
</div>
{% endblock %}
